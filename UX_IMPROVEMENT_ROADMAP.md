# チューサポ（Web版）UI/UX 改善ロードマップ & TODO

最終更新: 2025-12-22  
対象: `MedConsult`（Vite + React + TS + Tailwind + Supabase）

---

## 0. 目的（ゴール）

- **“壊れない”こと**: 押せない/遷移しない/データがズレる等の体験崩壊をゼロにする  
- **“迷わない”こと**: 初回でも次の行動（質問/検索/回答/プロフィール）が自然に分かる  
- **“一貫性”**: ログイン状態・データソース・画面間で表示と挙動が統一されている  
- **“安心”**: 失敗時に何が起きたか分かり、復帰導線がある（トースト/再試行/下書き等）

---

## 1. 優先度の定義

- **P0（最優先）**: 体験が壊れる / 信頼を落とす / データ不整合につながる
- **P1（重要）**: 使い勝手が明確に上がる / 継続率に効く
- **P2（改善）**: 磨き込み / パフォーマンス / 見た目の統一

---

## 2. 現状の主要課題（要約）

- **データ層の混在**: Supabase連携が進んでいる一方、UIコンポーネント側でLocalStorage系フック（`useAnswers` / `useGratitude`）を直接呼ぶ箇所が残っており、**ログイン時でも表示/更新がズレる可能性**がある  
- **導線の穴**: “押せるのに実際は未接続/未実装”が混在し、ユーザーの期待と結果がずれる  
- **Tailwindの動的class**: `bg-${color}-50` のような動的classは本番で生成されず、スタイルが崩れるリスクがある  

---

## 3. 改善ロードマップ（フェーズ設計）

### フェーズ0（完了済み）: 即効のP0潰し（導線/見え方の崩れ）

- [x] **モバイルのログイン導線**をヘッダーに追加（`Header.tsx`）
- [x] **「チューサポについて」**を実画面に接続（`App.tsx`）
- [x] **カテゴリ導線**をフィルタに接続（サイドバー/カテゴリカード → 質問一覧へスクロール）（`App.tsx`, `Sidebar.tsx`）
- [x] **ガイドラインの動的class問題**を明示マッピングに修正（`Guidelines.tsx`）
- [x] **カテゴリ件数**を実データから算出（`App.tsx`）
- [x] **デモ用 UserSelector**を通常表示から除外（`?demo-user` かつ LocalStorage時のみ）（`App.tsx`）

---

### フェーズ1（P0）: “データの一貫性”を完成させる（最重要）

狙い: **ログイン時は100% Supabase、未ログイン時は100% LocalStorage（デモ）**に揃え、画面ごとのズレをなくす。

**成果物（DoD）**
- ログイン時に、質問/回答/いいね/感謝/ベストアンサーが **同じデータソース**で表示・更新される
- UIからLocalStorage専用の状態更新が呼ばれない（ログイン時）

---

### フェーズ2（P1）: 使い勝手・完了率を上げる（検索/一覧/投稿）

狙い: “探せる・投稿できる・戻れる”を強化し、利用継続に効く改善を入れる。

**成果物（DoD）**
- 検索が入力に追従（デバウンス）し、0件時の案内が統一される
- 「さらに読み込む」が実装される（もしくは撤去/無効化で誤解を防ぐ）
- ローディング/エラー/再試行が整備され、詰まらない

---

### フェーズ3（P2）: 品質（アクセシビリティ/速度/統一感）

狙い: “長く使える”ための土台作り。モバイル中心運用の耐性を上げる。

**成果物（DoD）**
- キーボード操作/フォーカス表示/ARIAが一定水準（最低限）を満たす
- 重いUIの描画が最適化され、スクロールがカクつかない

---

## 4. TODOリスト（実行順・チェックリスト）

> 記号: **[P0/P1/P2]** 優先度 / **[S/M/L]** 規模感（目安）

### 4.1 P0（最優先）: データ一貫性（Supabase ⇄ LocalStorage の混在解消）

- [x] **[P0][L] `QuestionCard.tsx` を `useDataProvider` に統一**
  - `useAnswers` / `useGratitude` 直呼びを撤去
  - 回答取得: Props から `answers` を受け取り
  - 感謝: `onToggleGratitude` / `isAnswerGratitude` を使用
  - ベストアンサー: `onBestAnswerSelect` を使用

- [x] **[P0][L] `QuestionDetail.tsx` を `useDataProvider` に統一**
  - 回答投稿: `onAddAnswer`
  - 感謝/解除: `onToggleGratitude`
  - ベストアンサー選択/解除: `onSelectBestAnswer`
  - Props 経由でデータ・関数を受け取る形式に変更

- [x] **[P0][M] `UserProfile.tsx` のデータ元を整理**
  - `useSupabaseAuth` を追加し、認証状態に応じてデータソースを分岐
  - ログイン時は `supabaseUser` を使用、未ログイン時は `useUser` / `useGratitude` を使用

- [x] **[P0][M] 型の整備（FilterOptionsの統合）**
  - `SearchAndFilter` の `FilterOptions` に `hasAcceptedAnswer` / `sortBy` をオプショナルで追加
  - `AnswerQuestions` との型の一貫性を確保

- [x] **[P0][S] デバッグ/デモUIの露出制御を明確化**
  - `CHUSAPO_SYSTEM_GUIDE.md` に「デバッグ/デモモード」セクションを追加

---

### 4.2 P1（重要）: 検索・一覧・投稿のUX ✅ 完了

- [x] **[P1][M] 検索UXの改善**
  - 入力即反映（300msデバウンス）
  - "検索中"の状態表示（ローディングアイコン）
  - 0件時のEmpty Stateを全画面で統一

- [x] **[P1][M] 「さらに読み込む」問題の解消**
  - クライアントサイドページング実装（10件表示 → さらに読み込む）

- [x] **[P1][S] トースト/エラーハンドリング統一**
  - トースト通知システム実装（success/error/info）
  - ToastContext によるグローバル管理

- [x] **[P1][S] 認証導線の明確化**
  - handleAuthRequiredAction でログイン必要操作を案内

- [x] **[P1][M] フォームの入力負荷を下げる**
  - ログイン時は author/role を自動表示・読み取り専用化

---

### 4.3 P2（改善）: アクセシビリティ / パフォーマンス / UI統一 ✅ 完了

- [x] **[P2][M] アクセシビリティ最低限**
  - `focus-visible` のグローバルスタイル追加（index.css）
  - モーダルの `Esc` キー対応（QuestionForm, QuestionDetail）
  - 背景スクロール制御の統一

- [x] **[P2][M] パフォーマンス最適化**
  - QuestionCard を React.memo でラップ
  - useMemo で回答フィルタリング・ソートをメモ化

- [x] **[P2][S] "未実装ボタン"の扱い**
  - 「PDF版をダウンロード」→「PDF版（準備中）」に変更、disabled 化

- [x] **[P2][S] UIの文言/スタイル統一**
  - ボタン文言が統一されていることを確認

---

## 5. リスクと注意点

- **最大のリスク**: “SupabaseとLocalStorageの混在”は、バグが出た時に原因追跡が難しくなるため、最優先で統一する  
- **Tailwind動的class**: 文字列テンプレでclassを作ると本番で欠落するため、**必ず明示マッピング**で扱う  
- **段階導入**: フェーズ1は影響範囲が広いので、画面単位で順に統一（QuestionDetail→QuestionCard→UserProfile）がおすすめ

---

## 6. 次の着手（おすすめ順）

1. **フェーズ1（P0）**: `QuestionDetail.tsx` → `QuestionCard.tsx` を `useDataProvider` に統一  
2. **P0**: `UserProfile.tsx` のデータ元整理  
3. **P1**: 検索UX（デバウンス + 0件時の統一）  
4. **P1**: “さらに読み込む”の方針決定（実装 or 撤去）


