# チューサポ：今後の機能アイデア集（メモ）

作成日: 2025-12-23  
目的: 「入れるとより良くなる機能案」を散逸させずに保管し、優先度付けの土台にする。

---

## 1. 追加すると価値が上がる機能案

### 1.1 投稿品質を上げて“解決まで”を短縮する

- **質問テンプレート（症例フォーム）**  
  「部位/血管所見/患者背景（匿名）/使用物品/試行回数/困っている点」などをガイド入力化し、回答がしやすい質問に整える。

- **回答テンプレート（手技の型）**  
  「評価→準備→手順→コツ→失敗時リカバリ→禁忌/注意」を促すUIで回答品質の底上げ。

- **投稿前の“類似質問”提示**  
  タイトル入力中に近い質問を提示し、重複投稿を減らして自己解決率を上げる。

### 1.2 忙しい現場でも“追える・戻れる・学べる”を強化する

- **フォロー/ブックマーク/保存検索**  
  気になる質問・タグ・検索条件を保存し、後で復習しやすくする。

- **タグ購読＋週次/日次ダイジェスト通知**  
  自分の担当領域（採血/ルート等）だけを効率よくキャッチ。

### 1.3 安全・コンプラを“仕組みで”担保する

- **匿名化チェック/危険ワード検出**  
  患者特定につながる情報（氏名・ID・病棟名等）や危険手技の投稿前警告。

- **通報/モデレーション導線＋“根拠”添付**  
  不適切投稿の対応導線と、ガイドライン/文献/施設手順など根拠を添えやすくする。

### 1.4 コミュニティ定着（継続率）を上げる

- **メンタリング（新人↔ベテランのペアリング）**  
  期間限定の相談窓口（例: 2週間）で定着率を上げる。

- **失敗事例ライブラリ（匿名のケース集）**  
  「うまくいかなかった→原因→次回の改善」を蓄積して教育資産にする。

- **学習モード（チェックリスト/クイズ/ミニ講座）**  
  Q&Aを「学べる教材」に変換して継続利用を促進。

---

## 2. 画像投稿（匿名OK）の保存先と費用メモ

### 2.1 まず押さえるポイント（費用が増える原因）

- **ストレージ容量**: 画像が増えるほど月額が増える
- **転送量（閲覧回数）**: 画像は“見られる回数”で転送量が増え、費用が跳ねやすい
- **画像サイズ**: 1枚が大きいと容量も転送量も一気に増える

簡易見積りの考え方（概算）:

- **容量（GB）** ≒ 画像枚数 × 平均ファイルサイズ（MB） ÷ 1024
- **転送量（GB/月）** ≒ 画像枚数 × 月間平均閲覧回数 × 平均ファイルサイズ（MB） ÷ 1024

### 2.2 推奨（現状の実装に最も自然）: Supabase Storage

現状すでに **Supabase Storage を使った画像アップロード（プロフィール用アバター）**があり、以下が用意されています。

- **実装**: `src/lib/storage.ts`, `src/components/common/ImageUpload.tsx`
- **バケット**: `avatars`
- **制限**: 5MB、MIME制限（jpeg/png/gif/webp）
- **RLSポリシーSQL**: `supabase/migrations/*_storage_policies.sql`

症例画像などを追加する場合は、基本的には **別バケット（例: `case-images`）** を切って運用するのが安全です。

- **Publicにしない（推奨）**: 匿名化していても、公開URLは拡散・再利用されやすい  
  → **Private + signed URL（期限付き）** で閲覧制御する設計が安心です。

#### 料金の目安（2025-12-22時点 / [Supabase Pricing](https://supabase.com/pricing)）

- **Free**: **$0/月**（Storage **1GB**込み、Egress **5GB**込み）
- **Pro**: **$25/月**（Storage **100GB**込み、Egress **250GB**込み）
- **超過単価**: Storage **$0.021/GB**、Egress **$0.09/GB**

> 料金・無料枠は変わり得るため、最終判断は必ず公式で確認する。

#### 投稿数100 / 1000の概算（例）

前提（例）:

- **平均画像サイズ**: 0.5MB（圧縮/リサイズ後）
- **閲覧回数**: 「1枚あたり月10回（低）/100回（中）/500回（高）」の3パターン

計算:

- **追加ストレージ（GB/月）** ≒ 投稿枚数 × 0.5 ÷ 1024
- **Egress（GB/月）** ≒ 投稿枚数 × 閲覧回数 × 0.5 ÷ 1024

結果（目安）:

- **月100枚**
  - 追加ストレージ: 約 **0.05GB/月**
  - Egress: 10回→約 **0.5GB** / 100回→約 **4.9GB** / 500回→約 **24GB**
- **月1000枚**
  - 追加ストレージ: 約 **0.49GB/月**
  - Egress: 10回→約 **4.9GB** / 100回→約 **49GB** / 500回→約 **244GB**

読み替え:

- **ほとんどのケースでは Pro の無料枠（Egress 250GB）内**に収まる  
  （ただし「1000枚×500回/月×0.5MB」だと **上限付近**）
- 超過した場合の追加費用（例）: **(Egressが250GBを超えた分) × $0.09/GB**

#### “プレミアム限定アップロード”が効く理由

- コストを押し上げやすいのは **ストレージよりEgress（閲覧）**  
  → **アップロード者を絞る**＋（必要なら）**フル画像閲覧をログイン/プレミアムに制限**が効果的

### 2.3 コストを抑える“実装ルール”（匿名性にも効く）

- **上限サイズを小さくする**: 例）2MB以下（アバターは5MBでも、症例は小さめ推奨）
- **アップロード前に圧縮/リサイズ**: 長辺 1600px 程度に縮小、WebP化（容量と転送量を同時に削減）
- **EXIF削除**: 撮影日時/位置情報などのメタデータを除去（匿名性にも重要）
- **サムネイル運用**: 一覧はサムネイル、詳細で原寸（転送量を抑える）
- **保持期間/削除**: 一定期間で自動削除、または投稿者が削除可能にする
- **クォータ（上限）**: ユーザー別・月別で枚数/容量を制限（予算コントロール）

### 2.4 代替案（画像が多く“転送量”が重くなりそうな場合）

- **Cloudflare R2**: 転送コストを抑えやすい選択肢（ただし認証・署名URLの実装が増える）
- **AWS S3 + CloudFront**: 柔軟だが設定が増える（運用が本格化した段階で検討しやすい）
- **Vercel Blob 等**: Vercel中心運用なら選択肢（同様に料金は要確認）

### 2.5 参考：他のSNS/コミュニティはどう扱っているか（“運用パターン”）

#### 一般SNS（Instagram / YouTube / TikTok / X など）

- **基本はオープンな拡散設計**: 投稿が広く見られる前提なので、医療の症例画像/動画（患者由来）にはリスクが高い
- **対策は“ガイドライン＋通報＋事後モデレーション”が中心**: プラットフォーム側が医療向け匿名化をしてくれるわけではない
- **動画は当たり前に“圧縮・トランスコード・サムネ生成”**される: 見やすい一方、運営側は大規模インフラで成立している

#### 医療者向けコミュニティ（症例共有系）

一般的に以下の設計が多いです（サービス名に依存しない“型”）:

- **アクセス制御**: ログイン必須、場合により医療者認証（職種/資格）を要求
- **匿名化の強制**: 患者識別につながる情報の禁止（氏名/ID/顔/施設名/日付/バーコード等）
- **投稿時チェック**: 「匿名化済み」「同意取得済み（必要なら）」などのチェックボックス/注意喚起
- **モデレーション強化**: 通報→優先審査、違反時の即時非表示/アカウント制裁
- **“教育目的”の位置付け**: 免責や利用規約を強めに置く（医療行為の代替ではない等）

#### 動画の扱い（どこも難しい）

- **コストが跳ねやすい**（ストレージ＋Egress＋トランスコード）ので、初期は
  - **外部動画リンク（YouTube限定公開等）を貼れる**運用
  - もしくは **短尺・低解像度・プレミアム限定**で段階導入
  が現実的です。

#### チューサポに落とすなら（おすすめ順）

- **まず画像（静止画）から**: 圧縮/EXIF削除/サムネ生成/Private+signed URL の運用がしやすい
- **動画はPhase 2以降**: まずは「外部リンク」→需要が固まったら **Mux / Cloudflare Stream 等**の動画基盤を検討
- **プレミアム限定アップロードは相性が良い**: 投稿量（コスト）を制御しやすい＋“責任ある投稿”を促しやすい

#### 決定事項（2025-12-23）

- **動画投稿は当面「外部リンクのみ」**（チューサポ側で動画ファイルはホストしない）

外部リンク運用の最低限（推奨）:

- **許可ドメインのホワイトリスト**: 例）YouTube / Vimeo（※まずはこの2つに限定）
- **URL検証**: 正規表現＋URLパーサで形式チェック、怪しいクエリや短縮URLは弾く
- **表示方針**:
  - 初期は **リンクカード（タイトル/サムネ/ドメイン）＋クリックで新規タブ**
  - 埋め込みをする場合は **iframe の許可元を限定**し、`sandbox`/`referrerpolicy` を付与
- **注意喚起UI**: 投稿前に「患者識別情報が映らない」「音声に氏名等が入らない」等のチェックを必須化
- **通報導線**: 動画リンクも通報対象に含め、即時非表示（または審査待ち非表示）ができる運用

---

## 3. 未確認（次に決めると設計が固まる）

- **主な利用シーン**: 病棟 / 外来 / 救急 / 検査室 など、どこが最多想定か
- **症例画像の公開範囲**: ログインユーザー全体に見せる / 一部（認証済み以上）に限定する など


