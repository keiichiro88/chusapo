# クイズ作成ワークフロー（PDFからの画像認識ベース）

このドキュメントは、PDF書籍（スキャン画像）から高品質なクイズアプリ用データを作成するためのワークフローを定めたものです。Geminiの高度な画像認識能力を活用し、テキストデータがない状態から詳細なコンテンツを作成します。

## 1. 準備フェーズ

### 1.1 画像抽出
PDFはスキャンデータ（画像）の集合体であるため、OCRツールではなく画像抽出スクリプトを使用します。

- **入力**: 書籍のPDFファイル
- **処理**: PDF内の埋め込み画像（JPEG/DCTDecode）を直接抽出
- **出力**: ページごとの高解像度JPEG画像（`img-0001.jpg`, `img-0002.jpg`...）

### 1.2 範囲決定
- クイズ化する対象の「Lesson」または「章」のページ範囲を特定します。
- 例: Lesson 1（p.1〜p.10）に対応する画像番号（例: `img-0008.jpg` 〜 `img-0017.jpg`）を確認。

## 2. コンテンツ解析フェーズ（Gemini活用）

### 2.1 全文テキスト化（詳細読み取り）
対象範囲の全画像をAI（Gemini）に読み込ませ、**「可能な限り詳細に文字を全て読み取る」** 指示を出します。

**プロンプト例**:
> 「Lesson X（p.Y〜p.Z）の画像に含まれる全ての文字を詳細に読み取り、テキスト化してください。図表やイラスト内の注釈、コラムも含めて漏らさず書き起こしてください。」

**出力例**:
- 見出し、本文、コラム、図表のキャプション
- 重要なポイント、強調箇所
- ページ番号

### 2.2 要点整理
書き起こしたテキストから、学習者が覚えるべき重要なポイントを抽出します。
- **重要概念**: 手順、数値、解剖学的名称、禁忌事項
- **図表の内容**: 物品リスト、フローチャート（失敗時の対応など）
- **メンタル/コツ**: 著者が強調している心構えやテクニック

## 3. クイズ作成フェーズ

### 3.1 問題設計
抽出した要点に基づき、4択問題を作成します。

- **問題数**: 1レッスンあたり5〜10問程度（ボリュームに応じる）
- **形式**: 4択（正解1つ、不正解3つ）
- **不正解の作り方**:
    - よくある間違い
    - 数値の誤り（例: 15度→45度）
    - 手順の逆転
    - 著者の主張と反対の内容

### 3.2 解説の作成（必須）
- **正解の根拠**: なぜそれが正解なのかを論理的に説明。
- **引用元の明記**: 書籍の該当ページ（`p.X 参照`）を必ず含める。
- **補足情報**: 不正解の選択肢がなぜ誤りなのかも簡単に触れると親切。

**データ構造（TypeScript）**:
```typescript
{
  id: 'q1-1',
  questionText: '問題文...',
  options: [
    { id: 'a', text: '選択肢A', isCorrect: false },
    { id: 'b', text: '選択肢B（正解）', isCorrect: true },
    ...
  ],
  explanation: '解説文... (書籍 p.X 参照)',
}
```

## 4. 実装・検証フェーズ

### 4.1 データ実装
- `src/quiz/quizData.ts` に作成した問題データを追記します。

### 4.2 動作確認
- 開発サーバー (`npm run dev`) を起動。
- クイズアプリを開き、以下の点を確認：
    - 問題文・選択肢の表示崩れがないか
    - 正解/不正解の判定が正しいか
    - 解説文と参照ページが適切に表示されるか

## 5. 運用ルール
- **品質重視**: 自動生成任せにせず、必ず書き起こしテキストと照らし合わせて正確性を担保する。
- **著作権配慮**: 解説文は書籍の内容を「要約・解説」する形とし、書籍そのもののデッドコピーにならないように独自の言い回しで補足する（「著者は〜と述べている」等）。


